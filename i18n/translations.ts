import type { LanguageCode, TranslationDictionary } from './types';

export const SUPPORTED_LANGUAGES: LanguageCode[] = ['pt-BR', 'en-US'];

export const LANGUAGE_LABELS: Record<LanguageCode, string> = {
  'pt-BR': 'Português (Brasil)',
  'en-US': 'English (US)',
};

export const DEFAULT_LANGUAGE: LanguageCode = 'pt-BR';

const messages: Record<LanguageCode, TranslationDictionary> = {
  'pt-BR': {
    'common.confirm': 'Confirmar',
    'common.cancel': 'Cancelar',
    'common.loading': 'Carregando...',
    'common.empty': 'Nenhum item encontrado.',
    'common.error': 'Ocorreu um erro inesperado.',
    'common.language.ptBR': 'Português (Brasil)',
    'common.language.enUS': 'English (US)',
    'common.terms': 'Ao continuar, você concorda com nossos Termos e Política de Privacidade.',
    'common.dismiss': 'Fechar',

    'login.title': 'Bem-vindo',
    'login.subtitle': 'Entre para continuar',
    'login.emailHeading': 'Entrar com email e senha',
    'login.emailPlaceholder': 'email@exemplo.com',
    'login.passwordPlaceholder': 'Senha',
    'login.forgotPassword': 'Esqueci minha senha',
    'login.submit': 'Entrar',
    'login.createAccount': 'Criar conta com email',
    'login.or': 'ou',
    'login.authenticating': 'Autenticando…',
    'login.languageButton': 'Idioma',
    'login.provider.apple': 'Continuar com Apple (Simulado)',
    'login.provider.google': 'Continuar com Google (Simulado)',
    'login.provider.microsoft': 'Continuar com Microsoft (Simulado)',
    'login.footerPrefix': 'Ao continuar, você concorda com nossos',
    'login.footerTerms': 'Termos',
    'login.footerPrivacy': 'Política de Privacidade',
    'login.footerAnd': 'e',

    'phone.title': 'Verificação de telefone',
    'phone.subtitle': 'Insira seu número para continuar',
    'phone.dddLabel': 'DDD',
    'phone.numberLabel': 'Número',
    'phone.submit': 'Enviar código',
    'phone.resend': 'Reenviar código',
    'phone.pending': 'Enviando...',
    'phone.infoPending': 'Precisamos confirmar seu telefone para liberar o acesso.',
    'phone.expired': 'Fluxo expirado. Faça login novamente.',
    'phone.invalidDDD': 'Informe o DDD com 2 dígitos.',
    'phone.invalidPhone': 'Informe o telefone no formato XXXXX-XXXX.',
    'phone.sentInfo': 'Enviamos um código de 5 dígitos para o número informado.',
    'phone.ddPlaceholder': 'DD',
    'phone.numberPlaceholder': 'XXXXX-XXXX',

    'code.title': 'Confirme o código',
    'code.subtitle': 'Enviamos um código por SMS',
    'code.instructions': 'Insira os 5 dígitos recebidos para concluir sua autenticação.',
    'code.inputPlaceholder': 'Código de verificação',
    'code.submit': 'Confirmar',
    'code.resend': 'Reenviar código',
    'code.expired': 'Fluxo expirado. Faça login novamente.',
    'code.invalidLength': 'Digite os 5 dígitos do código.',
    'code.sentTo': 'Enviamos para {phone}',
    'code.back': 'Corrigir telefone',

    'home.heading.default': 'Livros Disponiveis',
    'home.heading.search': 'Resultado: "{text}"',
    'home.filter': 'Filtrar',
    'home.searchPlaceholder': 'Buscar por título ou autor',
    'home.searchSubmit': 'Buscar',
    'home.searchClear': 'Limpar',
    'home.keyboardDismiss': 'Fechar',
    'home.error': 'Não foi possível carregar os livros.',
    'home.loading': 'Carregando...',
    'home.empty': 'Nenhum item nesta página.',
    'home.totalSingular': '{count} livro no total',
    'home.totalPlural': '{count} livros no total',
    'home.rows.library': 'Sua biblioteca',
    'home.rows.new': 'Novos na Coleção',
    'home.rows.recommended': 'Escolhidos para você',
    'home.rows.search': 'Resultados para "{text}"',
    'home.rows.genrePrefix': 'Gênero: {name}',
    'home.rows.searchEmpty': 'Nenhum livro encontrado para esta busca.',
    'home.rows.emptyDefault': 'Nenhum livro disponível.',
    'home.rows.libraryEmpty': 'Adicione livros aos favoritos para vê-los aqui.',
    'home.rows.randomEmpty': 'Ainda não encontramos títulos para este tema.',
    'home.rows.topRead': 'Mais lidos',
    'home.rows.continue': 'Continue lendo',
    'home.rows.rewatch': 'Leia novamente',
    'home.rows.recommendBecause': 'Porque você leu {title}',
    'home.rows.recommendFallback': 'Porque você terminou seu último livro',
    'home.rows.insightEmpty': 'Nenhum livro disponível.',
    'home.shelf.retry': 'Tentar novamente',
    'home.shelf.empty': 'Nenhum livro disponível.',

    'library.heading': 'Biblioteca',
    'library.empty': 'Nenhum favorito encontrado.',
    'library.loading': 'Carregando favoritos...',
    'library.emptyPage': 'Nenhum favorito nesta página.',
    'library.none': 'Nenhum livro nos favoritos ainda.',
    'library.totalSingular': '{count} livro favoritado',
    'library.totalPlural': '{count} livros favoritados',

    'book.author': 'Autor',
    'book.year': 'Ano',
    'book.language': 'Idioma',
    'book.genres': 'Gêneros',
    'book.summaryTitle': 'Leitura em voz',
    'book.summaryLoading': 'Carregando resumo...',
    'book.summaryExpand': 'Toque para expandir e facilitar a leitura',
    'book.summaryCollapse': 'Toque para recolher',
    'book.audioLoading': 'Carregando áudio...',
    'book.noCover': 'Sem capa',
    'book.yourRating': 'Sua avaliação',
    'book.yourRatingValue': 'Avaliação: {rating}/5',
    'genre.title': 'Selecione um gênero',
    'genre.clear': 'Limpar filtro',
    'genre.close': 'Fechar',

    'profile.language': 'Idioma preferido',
    'profile.languageDescription': 'Escolha o idioma da interface',
    'profile.languageUpdated': 'Idioma atualizado com sucesso.',
    'profile.languageButton': 'Idioma',
    'profile.email': 'Email',
    'profile.emailMissing': 'Não informado',
    'profile.phone': 'Telefone',
    'profile.phoneMissing': 'Não verificado',
    'profile.changePhone': 'Alterar telefone',
    'profile.signOut': 'Sair',
    'profile.delete': 'Excluir conta',
    'profile.greeting': 'Olá!',
    'profile.signOutConfirmTitle': 'Sair',
    'profile.signOutConfirmMessage': 'Deseja encerrar a sessão?',
    'profile.cancel': 'Cancelar',

    // Auth (multi-idioma)
    'auth.common.back': 'Voltar',
    'auth.common.sendCode': 'Enviar código',
    'auth.common.resendCode': 'Reenviar código',
    'auth.common.resendIn': 'Reenviar em {seconds}s',
    'auth.common.confirm': 'Confirmar',
    'auth.common.next': 'Avançar',
    'auth.common.submit': 'Enviar',
    'auth.common.emailPlaceholder': 'email@exemplo.com',

    'auth.register.title': 'Criar conta',
    'auth.register.subtitle': 'Informe um email válido para receber o código de verificação.',

    'auth.verifyEmail.title': 'Verifique seu email',
    'auth.verifyEmail.subtitleWithEmail': 'Digite o código enviado para\n{email}',
    'auth.verifyEmail.subtitleGeneric': 'Digite o código enviado ao seu email.',

    'auth.password.title': 'Definir senha',
    'auth.password.subtitle': 'Crie uma senha para finalizar o cadastro.',
    'auth.password.placeholder': 'Senha (mínimo 8 caracteres)',
    'auth.password.optionalName': 'Nome (opcional)',
    'auth.password.confirm': 'Confirme a senha',
    'auth.password.mismatch': 'As senhas precisam ser iguais.',
    'auth.password.hint': 'A senha deve ter pelo menos {min} caracteres.',
    'auth.password.continue': 'Continuar',
    'auth.password.saveAndContinue': 'Salvar e continuar',
    'auth.password.show': 'Mostrar',
    'auth.password.hide': 'Ocultar',

    'auth.forgot.title': 'Recuperar senha',
    'auth.forgot.subtitle': 'Informe seu email para enviar o código de recuperação.',
    'auth.forgot.codeTitle': 'Recuperar senha',
    'auth.forgot.codeSubtitle': 'Digite o código enviado para\n{email}',
    'auth.forgot.passwordTitle': 'Nova senha',
    'auth.forgot.passwordSubtitle': 'Defina sua nova senha para continuar.',

    'auth.reset.subtitleEmail': 'Email: {email}',

    'auth.terms.title': 'Termos de Uso',
    'auth.terms.paragraph1':
      'Antes de continuar, confirme que está de acordo com os termos de uso e a política de privacidade do Audiolivros. Eles descrevem como seus dados são utilizados, quais são as regras de uso do conteúdo e as responsabilidades de cada parte.',
    'auth.terms.paragraph2':
      'Ao aceitar, você autoriza o processamento dos dados necessários para funcionamento do aplicativo e declara que usará o conteúdo apenas para fins pessoais, respeitando os direitos dos autores.',
    'auth.terms.expiresAt': 'O aceite expira em: {label}',
    'auth.terms.acceptIn': 'Aceitar em {seconds}s',
    'auth.terms.accept': 'Aceito',
    'auth.terms.cancel': 'Cancelar',
    'auth.terms.missingToken': 'Não encontramos seu token de aceite. Volte ao login para gerar um novo.',
  },
  'en-US': {
    'common.confirm': 'Confirm',
    'common.cancel': 'Cancel',
    'common.loading': 'Loading...',
    'common.empty': 'No items found.',
    'common.error': 'An unexpected error occurred.',
    'common.language.ptBR': 'Portuguese (Brazil)',
    'common.language.enUS': 'English (US)',
    'common.terms': 'By continuing, you agree to our Terms and Privacy Policy.',
    'common.dismiss': 'Close',

    'login.title': 'Welcome',
    'login.subtitle': 'Sign in to continue',
    'login.emailHeading': 'Sign in with email and password',
    'login.emailPlaceholder': 'email@example.com',
    'login.passwordPlaceholder': 'Password',
    'login.forgotPassword': 'Forgot my password',
    'login.submit': 'Sign in',
    'login.createAccount': 'Create account with email',
    'login.or': 'or',
    'login.authenticating': 'Authenticating…',
    'login.languageButton': 'Language',
    'login.provider.apple': 'Continue with Apple (Simulated)',
    'login.provider.google': 'Continue with Google (Simulated)',
    'login.provider.microsoft': 'Continue with Microsoft (Simulated)',
    'login.footerPrefix': 'By continuing, you agree to our',
    'login.footerTerms': 'Terms',
    'login.footerPrivacy': 'Privacy Policy',
    'login.footerAnd': 'and',

    'phone.title': 'Phone verification',
    'phone.subtitle': 'Enter your number to continue',
    'phone.dddLabel': 'Area',
    'phone.numberLabel': 'Number',
    'phone.submit': 'Send code',
    'phone.resend': 'Resend code',
    'phone.pending': 'Sending...',
    'phone.infoPending': 'We need to confirm your phone to grant access.',
    'phone.expired': 'Flow expired. Please sign in again.',
    'phone.invalidDDD': 'Enter the 2-digit area code.',
    'phone.invalidPhone': 'Enter the phone number in the XXXXX-XXXX format.',
    'phone.sentInfo': 'We sent a 5-digit code to the number provided.',
    'phone.ddPlaceholder': 'Area',
    'phone.numberPlaceholder': 'XXXXX-XXXX',

    'code.title': 'Confirm the code',
    'code.subtitle': 'We sent you an SMS code',
    'code.instructions': 'Enter the 5 digits you received to finish your sign-in.',
    'code.inputPlaceholder': 'Verification code',
    'code.submit': 'Confirm code',
    'code.resend': 'Resend code',
    'code.expired': 'Flow expired. Please sign in again.',
    'code.invalidLength': 'Enter the 5-digit code.',
    'code.sentTo': 'Sent to {phone}',
    'code.back': 'Fix phone number',

    'home.heading.default': 'Available Books',
    'home.heading.search': 'Result: "{text}"',
    'home.filter': 'Filter',
    'home.searchPlaceholder': 'Search by title or author',
    'home.searchSubmit': 'Search',
    'home.searchClear': 'Clear',
    'home.keyboardDismiss': 'Close',
    'home.error': 'Unable to load books.',
    'home.loading': 'Loading...',
    'home.empty': 'No items on this page.',
    'home.totalSingular': '{count} book in total',
    'home.totalPlural': '{count} books in total',
    'home.rows.library': 'Your library',
    'home.rows.new': 'New in Collection',
    'home.rows.recommended': 'Picked for you',
    'home.rows.search': 'Results for "{text}"',
    'home.rows.genrePrefix': 'Genre: {name}',
    'home.rows.searchEmpty': 'No books matched this search.',
    'home.rows.emptyDefault': 'No books available.',
    'home.rows.libraryEmpty': 'Add books to your favorites to see them here.',
    'home.rows.randomEmpty': 'We could not find titles for this theme yet.',
    'home.rows.topRead': 'Most read',
    'home.rows.continue': 'Continue reading',
    'home.rows.rewatch': 'Read again',
    'home.rows.recommendBecause': 'Because you read {title}',
    'home.rows.recommendFallback': 'Because you finished your latest book',
    'home.rows.insightEmpty': 'No books available.',
    'home.shelf.retry': 'Try again',
    'home.shelf.empty': 'No books available.',

    'library.heading': 'My Favorites',
    'library.empty': 'No favorites found.',
    'library.loading': 'Loading favorites...',
    'library.emptyPage': 'No favorites on this page.',
    'library.none': 'No favorite books yet.',
    'library.totalSingular': '{count} favorite book',
    'library.totalPlural': '{count} favorite books',

    'book.author': 'Author',
    'book.year': 'Year',
    'book.language': 'Language',
    'book.genres': 'Genres',
    'book.summaryTitle': 'Voice reading',
    'book.summaryLoading': 'Loading summary...',
    'book.summaryExpand': 'Tap to expand and improve readability',
    'book.summaryCollapse': 'Tap to collapse',
    'book.audioLoading': 'Loading audio...',
    'book.noCover': 'No cover',
    'book.yourRating': 'Your rating',
    'book.yourRatingValue': 'Rating: {rating}/5',
    'genre.title': 'Choose a genre',
    'genre.clear': 'Clear filter',
    'genre.close': 'Close',

    'profile.language': 'Preferred language',
    'profile.languageDescription': 'Choose the interface language',
    'profile.languageUpdated': 'Language updated successfully.',
    'profile.languageButton': 'Language',
    'profile.email': 'Email',
    'profile.emailMissing': 'Not provided',
    'profile.phone': 'Phone',
    'profile.phoneMissing': 'Not verified',
    'profile.changePhone': 'Update phone',
    'profile.signOut': 'Sign out',
    'profile.delete': 'Delete account',
    'profile.greeting': 'Hello!',
    'profile.signOutConfirmTitle': 'Sign out',
    'profile.signOutConfirmMessage': 'Do you want to end your session?',
    'profile.cancel': 'Cancel',

    // Auth (multi-language)
    'auth.common.back': 'Back',
    'auth.common.sendCode': 'Send code',
    'auth.common.resendCode': 'Resend code',
    'auth.common.resendIn': 'Resend in {seconds}s',
    'auth.common.confirm': 'Confirm',
    'auth.common.next': 'Next',
    'auth.common.submit': 'Submit',
    'auth.common.emailPlaceholder': 'email@example.com',

    'auth.register.title': 'Create account',
    'auth.register.subtitle': 'Enter a valid email to receive the verification code.',

    'auth.verifyEmail.title': 'Check your email',
    'auth.verifyEmail.subtitleWithEmail': 'Enter the code sent to\n{email}',
    'auth.verifyEmail.subtitleGeneric': 'Enter the code we sent to your email.',

    'auth.password.title': 'Set password',
    'auth.password.subtitle': 'Create a password to finish signing up.',
    'auth.password.placeholder': 'Password (min 8 characters)',
    'auth.password.optionalName': 'Name (optional)',
    'auth.password.confirm': 'Confirm password',
    'auth.password.mismatch': 'Passwords must match.',
    'auth.password.hint': 'Password must be at least {min} characters.',
    'auth.password.continue': 'Continue',
    'auth.password.saveAndContinue': 'Save and continue',
    'auth.password.show': 'Show',
    'auth.password.hide': 'Hide',

    'auth.forgot.title': 'Recover password',
    'auth.forgot.subtitle': 'Enter your email to send the recovery code.',
    'auth.forgot.codeTitle': 'Recover password',
    'auth.forgot.codeSubtitle': 'Enter the code sent to\n{email}',
    'auth.forgot.passwordTitle': 'New password',
    'auth.forgot.passwordSubtitle': 'Set your new password to continue.',

    'auth.reset.subtitleEmail': 'Email: {email}',

    'auth.terms.title': 'Terms of Use',
    'auth.terms.paragraph1':
      'Before continuing, confirm that you agree with Audiolivros’ terms of use and privacy policy. They describe how your data is used, the rules for content usage, and each party’s responsibilities.',
    'auth.terms.paragraph2':
      'By accepting, you authorize processing of the data needed for the app to function and agree to use the content only for personal purposes, respecting authors’ rights.',
    'auth.terms.expiresAt': 'Acceptance expires at: {label}',
    'auth.terms.acceptIn': 'Accept in {seconds}s',
    'auth.terms.accept': 'I accept',
    'auth.terms.cancel': 'Cancel',
    'auth.terms.missingToken': 'We could not find your acceptance token. Go back to login to generate a new one.',
  },
};

export function translate(language: LanguageCode, key: string, params?: Record<string, string | number>) {
  const fallback = messages[DEFAULT_LANGUAGE][key];
  const template = messages[language]?.[key] ?? fallback ?? key;
  if (!params) return template;
  return Object.entries(params).reduce((acc, [paramKey, value]) => {
    return acc.replace(new RegExp(`{${paramKey}}`, 'g'), String(value));
  }, template);
}

export function normalizeLanguage(language?: string | null): LanguageCode {
  if (!language) return DEFAULT_LANGUAGE;
  const normalized = language === 'en' ? 'en-US' : language === 'pt' ? 'pt-BR' : language;
  return (SUPPORTED_LANGUAGES as readonly string[]).includes(normalized) ? (normalized as LanguageCode) : DEFAULT_LANGUAGE;
}

export function formatLanguageLabel(language: LanguageCode) {
  return LANGUAGE_LABELS[language] ?? language;
}

export default messages;
